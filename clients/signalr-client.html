<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SignalR Blog Client</title>
  <style>
    body { font-family: Segoe UI, sans-serif; margin: 0; padding: 24px; background: #f5f7fb; }
    .card { max-width: 760px; margin: 0 auto; background: #fff; border: 1px solid #dbe2ea; border-radius: 10px; padding: 16px; }
    input, button { padding: 8px 10px; border-radius: 6px; border: 1px solid #cbd5e1; }
    button { background: #0f766e; color: #fff; border: none; cursor: pointer; }
    ul { padding-left: 20px; }
    .row { display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 12px; }
    .muted { color: #64748b; font-size: 14px; }
  </style>
</head>
<body>
  <div class="card">
    <h1>SignalR PostCreated Listener</h1>
    <p class="muted">Connect and wait for events when a new post is created.</p>

    <div class="row">
      <input id="hubUrl" style="min-width: 420px" value="http://localhost:8080/hubs/notifications" />
      <button id="connectBtn">Connect</button>
    </div>

    <p id="status" class="muted">Disconnected</p>
    <ul id="events"></ul>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/8.0.7/signalr.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script>
    const statusEl = document.getElementById('status');
    const eventsEl = document.getElementById('events');
    const connectBtn = document.getElementById('connectBtn');
    const hubUrlInput = document.getElementById('hubUrl');
    let connection;

    connectBtn.addEventListener('click', async () => {
      if (connection) {
        await connection.stop();
      }

      connection = new signalR.HubConnectionBuilder()
        .withUrl(hubUrlInput.value)
        .withAutomaticReconnect()
        .configureLogging(signalR.LogLevel.Information)
        .build();

      connection.on('PostCreated', (event) => {
        const li = document.createElement('li');
        li.textContent = `${new Date().toLocaleTimeString()} - ${event.title} by ${event.authorName} (${event.id})`;
        eventsEl.prepend(li);
      });

      try {
        await connection.start();
        statusEl.textContent = 'Connected';
      } catch (error) {
        statusEl.textContent = `Connection failed: ${error}`;
      }
    });
  </script>
</body>
</html>
